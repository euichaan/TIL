# 29강 - 인덱스 작성과 삭제
표준 SQL에는 CREATE INDEX 명령은 없습니다. 인덱스 자체가 데이터베이스 제품에 의존하는 선택적인 항목으로 취급됩니다.  
대표적인 데이터베이스 제품에는 모두 인덱스 구조가 도입되어 있으며, 모두 비슷한 관리 방법으로 인덱스를 다룰 수 있습니다.  
## 1. 인덱스 작성
```SQL
CREATE INDEX 인덱스명 ON 테이블명 (열명1, 열명2)...
```
인덱스는 CREATE INDEX 명령으로 만듭니다. 인덱스에 이름을 붙여 관리하는데, 데이터베이스 객체가 될지 테이블의 열처럼 취급될지는 데이터베이스 제품에 따라 다릅니다.  
Oracle이나 DB2 등에서 인덱스는 스키마 객체가 됩니다. 따라서 스키마 내에 이름이 중복하지 않도록 지정해 관리합니다.  
한편 SQL Server나 MySQL에서 인덱스는 테이블 내의 객체가 됩니다. 따라서 테이블 내에 이름이 중복되지 않도록 지정해 관리합니다.  
  
```SQL
CREATE INDEX isample65 ON sample62(on);
```
sample62의 no 열에 isample65라는 인덱스를 지정합니다. 인덱스를 작성할 때는 저장장치에 색인용 데이터가 만들어집니다.  
테이블 크기에 따라 인덱스 작성시간도 달라지는데, 행이 대량으로 존재하면 시간도 많이 걸리고 저장공간도 많이 소비합니다.  
## 2. 인덱스 삭제
인덱스는 DROP INDEX 명령으로 삭제합니다.  
```SQL
# 스키마 객체의 경우
DROP INDEX 인덱스명

# 테이블 내 객체의 경우
DROP INDEX 인덱스명 ON 테이블명 
```
인덱스는 테이블에 의존하는 객체입니다. DROP TABLE로 테이블을 삭제하면 테이블에 작성된 인덱스도 자동으로 삭제됩니다.  
```SQL
DROP INDEX isample65 ON sample62;
```
인덱스를 작성해두면 검색이 빨라집니다. 작성한 인덱스의 열을 WHERE 구로 조건을 지정하여 SELECT 명령으로 검색하면 처리속도가 향상됩니다.  
하지만 모든 SELECT 명령에 적용되는 만능 인덱스는 작성할 수 없습니다. 한편 INSERT 명령의 경우에는 인덱스를 최신 상태로 갱신하는 처리가 늘어나므로 처리속도가 조금 떨어집니다.  
  
다음과 같이 인덱스를 작성했다고 가정합니다.
```SQL
CREATE INDEX isample65 ON sample62(a);
```
WHERE 구에 a 열에 대한 조건식을 지정한 경우 SELECT 명령은 인덱스를 사용해 빠르게 검색할 수 있습니다.  
예를 들어 다음과 같은 SELECT 명령이 됩니다.  
```SQL
SELECT * FROM sample62 WHERE a = 'chan';
```
그러나 WHERE구의 조건식에 a열이 전혀 사용되지 않으면 SELECT 명령은 isample62라는 인덱스를 사용할 수 없습니다.  
  
## 3. EXPLAIN
인덱스 작성을 통해 쿼리의 성능 향상을 기대할 수 있습니다. 이때 실제로 인덱스를 사용해 검색하는지를 확인하려면 EXPLAIN 명령을 사용합니다.  
```SQL
EXPLAIN SQL명령
```
EXPLAIN에 뒤이어 확인하고 싶은 SELECT 명령 등의 SQL 명령을 지정하면 됩니다. 다만 이 SQL 명령은 실제로는 실행되지 않습니다. 어떤 상태로 실행되는지를 데이터베이스가 설명해줄 뿐입니다.  
표준 SQL에는 존재하지 않는, 데이터베이스 제품 의존형 명령입니다.  
```SQL
EXPLAIN SELECT * FROM sample62 WHERE a = 'chan';
```
possible_keys라는 곳에 사용할 수 있는 인덱스가 표시되며, key는 사용된 인덱스가 표시됩니다.  
  
## 4. 최적화
SELECT 명령을 실행할 때 인덱스의 사용 여부를 선택한다는 것을 알았습니다. 이는 데이터베이스 내부의 최적화에 의해 처리되는 부분입니다.  
내부 처리에서는 SELECT 명령을 실행하기에 앞서 실행계획을 세웁니다. 실행계획에서는 '인덱스가 지정된 열이 WHERE 조건으로 지정되어 있으니 인덱스를 사용하자'와 같은 처리가 이루어집니다.  
EXPLAIN 명령은 이 실행계획을 확인하는 명령입니다.  
  
실행계획에서는 인덱스의 유무뿐만 아니라 인덱스를 사용할 것인지 여부에 대해서도 데이터베이스 내부의 최적화 처리를 통해 판단합니다.  
이때 판단 기준으로 인덱스의 품질도 고려합니다. 예를 들어 '예' 또는 '아니오'라는 값만 가지는 열이 있다면, 해당 열에 인덱스를 지정해도 다음과 같은 이진트리가 되어 좋은 구조를 가지지 못합니다.  
데이터의 종류가 적을수록 인덱스의 효율도 떨어집니다. 반대로 서로 다른 값으로 여러 종류의 데이터가 존재하면 그만큼 효율은 좋아집니다.  
이렇게 인덱스의 품질을 고려해 실행계획이 세워지는 것입니다.  