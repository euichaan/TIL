# 35강 - 정규화

테이블을 올바른 형태로 **변경**하고 **분할**하는 것을 정규화라 합니다.

정규화란 데이터베이스의 테이블을 규정된 올바른 형태로 개선해나가는 것입니다.

## 1. 정규화

예제를 통해 정규화해 나가면서 설명하겠습니다.

먼저, 쇼핑 사이트의 주문처리 시스템을 구축하겠습니다. 그에 앞서 간단한 주문 데이터로는 어떤 것이 필요할지 생각해 봅니다.

| 주문번호 | 날짜 | 성명 | 연락처 | 주문상품 |
| --- | --- | --- | --- | --- |
| 1 | 1/1 | 박준용 | 010-XXXX | 0001 OO 1개, 0002 XX 10개 |
| 2 | 2/1 | 김재진 | 010-XXXX | 0001 OO 2개, 0002 XX 3개 |
| 3 | 2/5 | 박준용 | 010-XXXX | 0001 OO 3개, 0002 XX 1개 |

여기서 주문상품 부분이 특별한 형식 없이 대충 만들어진 것처럼 보여 문제가 될 수 있습니다.

따라서 상품은 상품코드를 이용해 다루기로 했습니다.

정규화는 단계적으로 실시합니다. 그 첫 번째 단계가 제1 정규화로, 이를 시행하면 제1 정규형 테이블을 만들 수 있습니다.

## 2. 제1정규형

**관계형 데이터베이스의 테이블에는 하나의 셀에 하나의 값만 저장할 수 있다는 제약이 있습니다.** 이로 인해 주문상품의 데이터를 그대로 테이블로 만들 수는 없습니다.

적어도 상품코드와 상품명, 개수 데이터를 담는 세 개의 열로 나누어야 합니다.

| 주문번호 | 날짜 | 성명 | 연락처 | 상품코드 | 상품명 | 개수 |
| --- | --- | --- | --- | --- | --- | --- |
| 1 | 1/1 | 박준용 | 010-XXXX | 0001 | OO | 1 |
| 1 | 1/1 | 박준용 | 010-XXXX | 0002 | XX | 10 |
| 2 | 2/1 | 김재진 | 010-XXXX | 0001 | OO | 2 |
| 2 | 2/1 | 김재진 | 010-XXXX | 0002 | XX | 3 |
| 3 | 2/5 | 박준용 | 010-XXXX | 0001 | OO | 3 |
| 3 | 2/5 | 박준용 | 010-XXXX | 0003 | XX | 1 |

테이블 이름은 ‘주문’이라 하겠습니다.

하나의 셀에 하나의 값만 저장할 수 있도록 하고, 반복되는 부분을 세로(행) 방향으로 늘려나가는 것이 제1정규화의 제1단계입니다.

제1정규화에서는 중복을 제거하는 테이블의 분할도 이루어집니다.

예를 들면 한 번의 주문으로 여러 개의 상품을 주문할 수 있으므로 주문번호, 날짜, 성명, 연락처가 동일한 값을 가지는 행이 여러 개 존재할 수 있습니다. 

동일한 값을 가지는 행이 여러 개 존재하지 않도록 하나로 정리해보겠습니다.

먼저, 주문 테이블을 주문상품 테이블과 주문 테이블로 나눕니다.

**주문 테이블**

| 주문번호 | 날짜 | 성명 | 연락처 |
| --- | --- | --- | --- |
| 1 | 1/1 | 박준용 | 010-XXXX |
| 2 | 2/1 | 김재진 | 010-XXXX |
| 3 | 2/5 | 박준용 | 010-XXXX |

**주문상품 테이블**

| 주문번호 | 상품코드 | 상품명 | 개수 |
| --- | --- | --- | --- |
| 1 | 0001 | OO | 1 |
| 1 | 0002 | XX | 10 |
| 2 | 0001 | OO | 2 |
| 2 | 0002 | XX | 3 |
| 3 | 0001 | OO | 3 |
| 3 | 0003 | XX | 1 |

주문상품 테이블은 주문 테이블과 결합할 수 있도록 주문번호 열을 추가합니다.  

이것으로 주문 데이터가 변경되더라도 한 군데만 수정하면 됩니다.

여기에서 분할 이후의 주문 테이블을 자세히 살펴보면, 주문번호에는 중복된 값이 존재하지 않기 때문에 기본키로 지정할 수 있습니다.

한편 주문상품 테이블에서는 주문 번호와 상품코드를 한데 묶어 기본키로 지정할 수 있습니다.

이처럼 제1정규화에서는 **반복되는 부분을 찾아내서 테이블을 분할**하고 **기본키가 될 열을 작성**할 수 있습니다.

## 3. 제 2정규형

제2정규화에서는 데이터가 중복하는 부분을 찾아내어 테이블로 분할해 나갑니다.

이때 **기본키에 의해 특정되는 열과 그렇지 않은 열로 나누는 것으로 정규화가 이루어집니다.**

| 주문번호 | 상품코드 | 상품명 | 개수 |
| --- | --- | --- | --- |
| 1 | 0001 | OO | 1 |
| 1 | 0002 | XX | 10 |
| 2 | 0001 | OO | 2 |
| 2 | 0002 | XX | 3 |
| 3 | 0001 | OO | 3 |
| 3 | 0003 | XX | 1 |

주문상품의 기본키는 주문번호와 상품코드 두 개의 열로 되어 있습니다.

주문번호 1에 상품코드가 0001인 상품 주문량은 총 1개라는 것을 알 수 있습니다.

이것은 기본키를 바탕으로 특정되는 데이터입니다.

즉, 개수 열은 기본키가 결정되고 나면 특정할 수 있는 것입니다.

한편 상품명은 주문번호와 관계없이 상품코드만으로 특정할 수 있습니다.

상품코드는 기본키의 일부이긴 하지만 단독으로 기본키 역할을 할 수는 없습니다.

이처럼 두 가지로 분류할 수 있으므로 두 개 테이블로 분할하겠습니다.

**상품** 

| 상품코드 | 상품명 |
| --- | --- |
| 0001 | OO |
| 0002 | XX |
| 0003 | AA |

**주문상품**

| 주문번호 | 상품코드 | 개수 |
| --- | --- | --- |
| 1 | 0001 | 1 |
| 1 | 0002 | 10 |
| 2 | 0001 | 2 |
| 2 | 0002 | 3 |
| 3 | 0001 | 3 |
| 3 | 0003 | 1 |

상품 테이블은 상품코드만으로 기본키를 지정했습니다.

**부분 함수종속성을 찾아내서 테이블을 분할하는 것이 제2정규화입니다.**

함수종속성이란 키 값을 이용해 데이터를 특정지을 수 있는 것을 가리킵니다.

## 4. 제3정규형

제2정규화의 경우에는 기본키에 중복이 없는지 조사했습니다만

 **제3정규화에서는 기본키 이외의 부분에서 중복이 없는지를 조사합니다.**

**주문**

| 주문번호 | 날짜 | 성명 | 연락처 |
| --- | --- | --- | --- |
| 1 | 1/1 | 박준용 | 010-XXXX |
| 2 | 2/1 | 김재진 | 010-XXXX |
| 3 | 2/5 | 박준용 | 010-XXXX |

분할하기 전의 주문 테이블을 살펴보면 데이터가 중복되어 있습니다. 같은 사람이 여러 번 주문하는 경우가 있기 때문입니다.

이때 주문 테이블에서 이름을 기준으로 연락처를 특정지을 수 있습니다. 단, 주문 테이블의 기본키는 어디까지나 주문번호로, 이름은 기본키와는 관계가 없습니다.

주문

| 주문번호 | 날짜 | 고객번호 |
| --- | --- | --- |
| 1 | 1/1 | 1 |
| 2 | 2/1 | 2 |
| 3 | 2/5 | 1 |

고객

| 고객번호 | 성명 | 연락처 |
| --- | --- | --- |
| 1 | 박준용 | 010-XXXX |
| 2 | 김재진 | 010-XXXX |

고객 테이블에서 이름을 기본키로 지정하면 동명이인의 경우 데이터를 제대로 저장할 수 없으므로 고객번호를 기본키로 지정하여 고객 테이블을 작성했습니다.

정규화를 통해 분할한 테이블은 다음과 같습니다.

주문

| 주문번호 | 날짜 | 고객번호 |
| --- | --- | --- |
| 1 | 1/1 | 1 |
| 2 | 2/1 | 2 |
| 3 | 2/5 | 1 |

고객

| 고객번호 | 성명 | 연락처 |
| --- | --- | --- |
| 1 | 박준용 | 010-XXXX |
| 2 | 김재진 | 010-XXXX |

주문상품

| 주문번호 | 상품코드 | 개수 |
| --- | --- | --- |
| 1 | 0001 | 1 |
| 1 | 0002 | 10 |
| 2 | 0001 | 2 |
| 2 | 0002 | 3 |
| 3 | 0001 | 3 |
| 3 | 0003 | 1 |

상품

| 상품코드 | 상품명 |
| --- | --- |
| 0001 | OO |
| 0002 | XX |
| 0003 | AA |

테이블 간의 연계는 ER 다이어그램으로 표현하면 알기 쉽습니다.

주문상품 테이블과 상품 테이블 간의 연계(릴레이션십)에서는 상품 쪽이 일, 주문상품 쪽이 다 입니다.

즉, 주문상품 테이블 쪽의 데이터에서 상품 테이블을 보면 상품 테이블의 하나의 행을 특정하는 것입니다.

반대로 상품 테이블 쪽에서 주문상품 테이블을 보면 주문상품 테이블의 하나의 행만 특정할 수 없습니다. 다시 말해 여러 개의 행이 존재한다는 이야기입니다.

## 5. 정규화의 목적

정규화에서는 중복하거나 반복되는 부분을 찾아서 테이블로 분할하고 기본키를 작성해 사용하는 것을 기본 개념으로 삼습니다.

이는 **하나의 데이터는 한 곳에 있어야 한다**는 규칙에 근거합니다.

정규화되지 않은 경우에는 여기저기 중복해서 저장된 데이터를 검색하고 일일이 변경해야 합니다.