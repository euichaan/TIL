# 32강 - 테이블 결합
테이블의 결합(join)에 대해 자세히 알아보겠습니다.  
  
테이블의 집합 연산에서는 세로(행) 방향으로 데이터가 늘어나거나 줄어드는 계산을 했습니다.  
결합에서는 가로(열) 방향으로 데이터가 늘어나는 계산이 됩니다.  
  
보통 데이터베이스는 하나의 테이블에 많은 데이터를 저장하지 않고 몇 개의 테이블로 나누어 저장합니다. 이처럼 여러 개로 나뉜 데이터를 하나로 묶어 결과를 내는 방법이 테이블 결합입니다. 여기서 결합을 이해하는 동시에 기본이 되는 개념이 집합론의 '곱집합'입니다.  
  
### 1. 곱집합과 교차결합
Cartesian product라고도 불립니다.  
  
데이터베이스 테이블은 집합의 한 종류라고 할 수 있습니다. SELECT 문에 테이블을 두 개 지정하면 이들은 곱집합으로 계산됩니다.  
```SQL
SELECT * FROM 테이블명1, 테이블명2

SELECT * FROM sample72_x, sample72_y;
```

FROM 구에 복수의 테이블을 지정하면 교차결합 을 합니다. 교차결합은 두 개의 테이블을 곱집합으로 계산합니다.  
UNION으로 합집합을 구했을 경우에는 세로 방향으로 더해지게 됩니다. 한편 FROM 구로 테이블을 결합할 경우에는 가로 방향으로 더해지게 됩니다.  
  
### 2. 내부결합
결합 방법으로는 교차결합보다 내부결합이 자주 사용됩니다.  
  
다른 테이블의 데이터를 참조해야 하는 경우, 참조할 테이블의 기본키와 동일한 이름과 자료형으로 열을 만들어서 행을 연결하는 경우가 많습니다.  
```SQL
SELECT * FROM 상품, 재고수
  WHERE 상품.상품코드 = 재고수.상품코드;
```
이렇게 교차결합으로 계산된 곱집합에서 원하는 조합을 검색하는 것을 '내부결합(Inner Join)'이라 부릅니다.  
```SQL
SELECT * FROM 상품, 재고수
  WHERE 상품.상품코드 = 재고수.상품코드;
  AND 상품.상품분류 = '식료품';
```
첫 번째 조건식은 교차결합으로 계산된 곱집합에서 원하는 조합을 검색하는 것입니다.  
두 번째 조건식은 결합 조건이 아닌 검색 조건입니다. 첫 번째 조건식의 조건을 '결합조건'이라 부릅니다.  
  
### 3. INNER JOIN으로 내부결합하기
지금까지 설명한 결합방법은 다음과 같습니다.  
- FROM구에 테이블을 복수 지정해 가로 방향으로 테이블을 결합할 수 있다.  
- 교차결합을 하면 곱집합으로 계산된다.  
- WHERE조건을 지정해 곱집합에서 필요한 조합만 검색할 수 있다.  
사실 지금까지 설명한 결합방법은 구식입니다. 최근에는 INNER JOIN 키워드를 사용한 결합방법이 일반적으로 통용됩니다.  
```SQL
SELECT 상품.상품명, 재고수.재고수
  FROM 상품 INNER JOIN 재고수
  ON 상품.상품코드 = 재고수.상품코드
  WHERE 상품.상품분류 = '식료품';
```
새로운 형식에서는 테이블과 테이블 사이에 **INNER JOIN**이라는 키워드를 넣습니다.  
INNER는 안쪽이라는 의미이며 JOIN은 연결시킨다 라는 의미입니다. 즉 INNER JOIN은 내부결합이라는 의미가 됩니다.  
구식 방법에서는 WHERE 구에 결합조건을 지정하였지만 INNER JOIN에서는 ON을 사용하여 결합조건을 지정합니다.  
  
### 4. 내부결합을 활용한 데이터 관리
```SQL
SELECT S.상품명, M.메이커명
FROM 상품2 S INNER JOIN 메이커 M
ON S.메이커코드 = M.메이커코드;
```
이번에는 테이블에 별명을 붙여 보았습니다. SELECT 명령에서 복수의 테이블을 다룰 경우 어느 테이블의 열인지 정확히 지정해야 합니다.  
이때 테이블명을 매번 지정하는 것은 번거로운 일이므로 짧게 줄여 별명을 붙이는 경우가 많습니다.  
  
**외부키**  
메이커 테이블의 메이커코드는 기본키입니다. 그에 비해 상품 테이블의 메이커코드는 '외부키'라 불리는 것으로, 다른 테이블의 기본키를 참조하는 열이 외부키가 됩니다.  
  
**자기결합(Self Join)**  
자기결합은 테이블에 별명을 붙일 수 있는 기능을 이용해 같은 테이블끼리 결합하는 것을 말합니다.  
```SQL
SELECT S1.상품명, S2.상품명
  FROM 상품 S1 INNER JOIN 상품 S2
    ON S1.상품코드 = S2.상품코드;
```
사실 평소에는 이러한 결합을 할 일은 없습니다.  
자기결합은 자기 자신의 기본키를 참조하는 열을 자기 자신이 가지는 데이터 구조로 되어 있을 경우에 자주 사용됩니다.  
### 5. 외부결합
결합 방법은 크게 내부결합과 외부결합의 두 가지로 구분됩니다.  
외부결합이라고는 해도 교차결합으로 결합 조건을 지정하여 검색한다는 기본적인 사고 방식은 같습니다.  
외부결합은 '어느 한 쪽에만 존재하는 데이터행을 어떻게 다룰지'를 변경할 수 있는 결합 방법입니다.  
  
외부결합은 결합하는 테이블 중에 어느쪽을 기준으로 할지 결정할 수 있습니다.  
이번에는 상품 테이블(결합의 왼쪽)을 기준으로 LEFT JOIN을 사용해보겠습니다.  
```SQL
SELECT 상품3.상품명, 재고수.재고수
  FROM 상품3 LEFT JOIN 재고수
    ON 상품3.상품코드 = 재고수.상품코드
  WHERE 상품3.상품분류 = '식료품';
```
기준이 되는 상품 테이블을 JOIN의 왼쪽에 기술했으므로 LEFT JOIN이라 지정했습니다.  
상품 테이블을 오른쪽에 지정하는 경우나 재고 테이블을 기준으로 삼고 싶은 경우에는 RIGHT JOIN을 사용해 외부결합을 시행합니다.  
  
표준화로 인해 내부결합은 INNER JOIN, 외부결합은 LEFT JOIN이나 RIGHT JOIN을 사용하도록 권장합니다.  
